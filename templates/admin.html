<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–§–∏–ª—å–º–æ—Ç–µ–∫–∞ ‚Äî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">üé¨ –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ñ–∏–ª—å–º–æ—Ç–µ–∫–∏</h1>
        
        <!-- –§–æ—Ä–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ñ–∏–ª—å–º–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</h6>
                        <div class="input-group mb-2">
                            <input type="text" id="filmName" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞">
                        </div>
                        <div class="input-group mb-2">
                            <input type="number" id="filmYear" class="form-control" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞">
                        </div>
                        <div class="input-group mb-2">
                            <select id="filmDirector" class="form-control">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</option>
                            </select>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addFilm()">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –Ω–æ—Å–∏—Ç–µ–ª–µ–π -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Å–∏—Ç–µ–ª—å</h6>
                        <div class="input-group mb-2">
                            <select id="carrierFilm" class="form-control">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º</option>
                            </select>
                        </div>
                        <div class="input-group mb-2">
                            <select id="carrierType" class="form-control">
                                <option value="">–¢–∏–ø –Ω–æ—Å–∏—Ç–µ–ª—è</option>
                                <option value="DVD">DVD</option>
                                <option value="Blu-ray">Blu-ray</option>
                                <option value="–¶–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–ø–∏—è">–¶–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–ø–∏—è</option>
                            </select>
                        </div>
                        <div class="input-group mb-2">
                            <select id="carrierCondition" class="form-control">
                                <option value="">–°–æ—Å—Ç–æ—è–Ω–∏–µ</option>
                                <option value="–û—Ç–ª–∏—á–Ω–æ–µ">–û—Ç–ª–∏—á–Ω–æ–µ</option>
                                <option value="–•–æ—Ä–æ—à–µ–µ">–•–æ—Ä–æ—à–µ–µ</option>
                                <option value="–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</option>
                                <option value="–ü–ª–æ—Ö–æ–µ">–ü–ª–æ—Ö–æ–µ</option>
                                <option value="–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–æ">–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–æ</option>
                            </select>
                        </div>
                        <div class="input-group mb-2">
                            <input type="number" step="0.01" id="carrierPrice" class="form-control" placeholder="–¶–µ–Ω–∞">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addCarrier()">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Å–∏—Ç–µ–ª—å</button>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
                        <div class="input-group mb-2">
                            <input type="text" id="readerFio" class="form-control" placeholder="–§–ò–û">
                        </div>
                        <div class="input-group mb-2">
                            <input type="text" id="readerPhone" class="form-control" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addReader()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –∂–∞–Ω—Ä–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä</h6>
                        <div class="input-group mb-2">
                            <input type="text" id="genreName" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addGenre()">–î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä</button>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</h6>
                        <div class="input-group mb-2">
                            <input type="text" id="directorName" class="form-control" placeholder="–§–ò–û —Ä–µ–∂–∏—Å—Å—ë—Ä–∞">
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addDirector()">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion" id="adminAccordion">
            <!-- –§–∏–ª—å–º—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilms">
                        –§–∏–ª—å–º—ã ({{ films|length }})
                    </button>
                </h2>
                <div id="collapseFilms" class="accordion-collapse collapse show">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ì–æ–¥</th>
                                    <th>–†–µ–∂–∏—Å—Å—ë—Ä</th>
                                    <th>–ñ–∞–Ω—Ä—ã</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="filmsTableBody">
                                {% for film in films %}
                                <tr data-film-id="{{ film[0] }}">
                                    <td><strong>{{ film[1] }}</strong></td>
                                    <td>{{ film[2] }}</td>
                                    <td>{{ film[3] }}</td>
                                    <td>{{ film[4] | join(', ') if film[4] else '‚Äî' }}</td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-film-btn" data-film-id="{{ film[0] }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-film-btn" data-film-id="{{ film[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ù–æ—Å–∏—Ç–µ–ª–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCarriers">
                        –ù–æ—Å–∏—Ç–µ–ª–∏ ({{ carriers|length }})
                    </button>
                </h2>
                <div id="collapseCarriers" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–¢–∏–ø</th>
                                    <th>–§–∏–ª—å–º</th>
                                    <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–†–µ–∂–∏—Å—Å—ë—Ä</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="carriersTableBody">
                                {% for carrier in carriers %}
                                <tr data-carrier-id="{{ carrier[0] }}">
                                    <td><span class="badge bg-info">{{ carrier[1] }}</span></td>
                                    <td><strong>{{ carrier[5] }}</strong></td>
                                    <td>
                                        {% if carrier[2] == '–û—Ç–ª–∏—á–Ω–æ–µ' %}
                                            <span class="badge bg-success">–û—Ç–ª–∏—á–Ω–æ–µ</span>
                                        {% elif carrier[2] == '–•–æ—Ä–æ—à–µ–µ' %}
                                            <span class="badge bg-primary">–•–æ—Ä–æ—à–µ–µ</span>
                                        {% elif carrier[2] == '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ' %}
                                            <span class="badge bg-warning">–£–¥–æ–≤–ª.</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ carrier[2] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if carrier[3] > 0 %}
                                            {{ "%.2f"|format(carrier[3]) }} ‚ÇΩ
                                        {% else %}
                                            <span class="text-muted">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if carrier[4] == '–î–æ—Å—Ç—É–ø–µ–Ω' %}
                                            <span class="badge bg-success">–î–æ—Å—Ç—É–ø–µ–Ω</span>
                                        {% elif carrier[4] == '–í—ã–¥–∞–Ω' %}
                                            <span class="badge bg-warning">–í—ã–¥–∞–Ω</span>
                                        {% elif carrier[4] == '–ù–∞ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü–∏–∏' %}
                                            <span class="badge bg-info">–ù–∞ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü–∏–∏</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ carrier[4] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ carrier[6] }}</td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-carrier-btn" data-carrier-id="{{ carrier[0] }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-carrier-btn" data-carrier-id="{{ carrier[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –í—ã–¥–∞—á–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIssues">
                        –í—ã–¥–∞—á–∏ ({{ issues|length }})
                    </button>
                </h2>
                <div id="collapseIssues" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–ù–æ—Å–∏—Ç–µ–ª—å</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                                    <th>–ü–ª–∞–Ω. –≤–æ–∑–≤—Ä–∞—Ç</th>
                                    <th>–§–∞–∫—Ç. –≤–æ–∑–≤—Ä–∞—Ç</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="issuesTableBody">
                                {% for issue in issues %}
                                <tr data-issue-id="{{ issue[0] }}">
                                    <td><strong>{{ issue[9] }}</strong> ({{ issue[8] }})</td>
                                    <td>{{ issue[7] }}</td>
                                    <td>{{ issue[3] }}</td>
                                    <td>{{ issue[4] }}</td>
                                    <td>{{ issue[5] or "‚Äî" }}</td>
                                    <td>
                                        {% if issue[6] == '–ê–∫—Ç–∏–≤–Ω–∞' %}
                                            <span class="badge bg-warning">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                        {% elif issue[6] == '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' %}
                                            <span class="badge bg-success">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                                        {% else %}
                                            <span class="badge bg-danger">{{ issue[6] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-issue-btn" data-issue-id="{{ issue[0] }}">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-issue-btn" data-issue-id="{{ issue[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReaders">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ({{ readers|length }})
                    </button>
                </h2>
                <div id="collapseReaders" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–§–ò–û</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="readersTableBody">
                                {% for reader in readers %}
                                <tr data-reader-id="{{ reader[0] }}">
                                    <td>{{ reader[0] }}</td>
                                    <td><strong>{{ reader[1] }}</strong></td>
                                    <td>{{ reader[2] or "‚Äî" }}</td>
                                    <td>{{ reader[3] }}</td>
                                    <td>
                                        {% if reader[4] == '–ê–∫—Ç–∏–≤–µ–Ω' %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% elif reader[4] == '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' %}
                                            <span class="badge bg-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ reader[4] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-reader-btn" data-reader-id="{{ reader[0] }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-reader-btn" data-reader-id="{{ reader[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ñ–∞–Ω—Ä—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGenres">
                        –ñ–∞–Ω—Ä—ã ({{ genres|length }})
                    </button>
                </h2>
                <div id="collapseGenres" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="genresTableBody">
                                {% for genre in genres %}
                                <tr data-genre-id="{{ genre[0] }}">
                                    <td>{{ genre[0] }}</td>
                                    <td><strong>{{ genre[1] }}</strong></td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-genre-btn" data-genre-id="{{ genre[0] }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-genre-btn" data-genre-id="{{ genre[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –†–µ–∂–∏—Å—Å—ë—Ä—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDirectors">
                        –†–µ–∂–∏—Å—Å—ë—Ä—ã ({{ directors|length }})
                    </button>
                </h2>
                <div id="collapseDirectors" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–§–ò–û</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="directorsTableBody">
                                {% for director in directors %}
                                <tr data-director-id="{{ director[0] }}">
                                    <td>{{ director[0] }}</td>
                                    <td><strong>{{ director[1] }}</strong></td>
                                    <td>
                                        <button class="btn btn-warning btn-sm edit-director-btn" data-director-id="{{ director[0] }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="btn btn-danger btn-sm delete-director-btn" data-director-id="{{ director[0] }}">–£–¥–∞–ª–∏—Ç—å</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
        function apiCall(url, method, data = null) {
            return fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: data ? JSON.stringify(data) : null
            }).then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º
        function loadFormData() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã —Ñ–∏–ª—å–º–∞
            apiCall('/api/admin/directors', 'GET')
                .then(directors => {
                    const select = document.getElementById('filmDirector');
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</option>';
                    directors.forEach(d => {
                        const option = document.createElement('option');
                        option.value = d.id;
                        option.textContent = d.name;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading directors:', error);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–≤');
                });

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã –Ω–æ—Å–∏—Ç–µ–ª—è
            apiCall('/api/admin/films', 'GET')
                .then(films => {
                    const select = document.getElementById('carrierFilm');
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º</option>';
                    films.forEach(f => {
                        const option = document.createElement('option');
                        option.value = f.id;
                        option.textContent = f.name;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading films:', error);
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å–º–æ–≤');
                });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
        window.addFilm = function() {
            const name = document.getElementById('filmName').value;
            const year = document.getElementById('filmYear').value;
            const directorId = document.getElementById('filmDirector').value;

            if (!name || !year || !directorId) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const filmData = {
                name: name,
                year: parseInt(year),
                director_id: parseInt(directorId)
            };

            apiCall('/api/admin/films', 'POST', filmData)
                .then(data => {
                    if (data.success) {
                        alert('–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–ª—å–º–∞: ' + error.message);
                });
        };

        window.addCarrier = function() {
            const filmId = document.getElementById('carrierFilm').value;
            const type = document.getElementById('carrierType').value;
            const condition = document.getElementById('carrierCondition').value;
            const price = document.getElementById('carrierPrice').value;

            if (!filmId || !type || !condition || !price) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const carrierData = {
                film_id: parseInt(filmId),
                type: type,
                condition: condition,
                price: parseFloat(price)
            };

            apiCall('/api/admin/carriers', 'POST', carrierData)
                .then(data => {
                    if (data.success) {
                        alert('–ù–æ—Å–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ—Å–∏—Ç–µ–ª—è: ' + error.message);
                });
        };

        window.addReader = function() {
            const fio = document.getElementById('readerFio').value;
            const phone = document.getElementById('readerPhone').value;

            if (!fio) {
                alert('–í–≤–µ–¥–∏—Ç–µ –§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            const readerData = {
                fio: fio,
                phone: phone || '',
                status: '–ê–∫—Ç–∏–≤–µ–Ω'
            };

            apiCall('/api/admin/readers', 'POST', readerData)
                .then(data => {
                    if (data.success) {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + error.message);
                });
        };

        window.addGenre = function() {
            const name = document.getElementById('genreName').value;

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞');
                return;
            }

            const genreData = {
                name: name
            };

            apiCall('/api/admin/genres', 'POST', genreData)
                .then(data => {
                    if (data.success) {
                        alert('–ñ–∞–Ω—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∂–∞–Ω—Ä–∞: ' + error.message);
                });
        };

        window.addDirector = function() {
            const name = document.getElementById('directorName').value;

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Ä–µ–∂–∏—Å—Å—ë—Ä–∞');
                return;
            }

            const directorData = {
                name: name
            };

            apiCall('/api/admin/directors', 'POST', directorData)
                .then(data => {
                    if (data.success) {
                        alert('–†–µ–∂–∏—Å—Å—ë—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞: ' + error.message);
                });
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        function setupDeleteHandlers() {
            document.querySelectorAll('.delete-film-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filmId = this.getAttribute('data-film-id');
                    const filmName = this.closest('tr').querySelector('td:first-child strong').textContent;
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º "${filmName}"?`)) {
                        deleteFilm(filmId, this);
                    }
                });
            });

            document.querySelectorAll('.delete-carrier-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const carrierId = this.getAttribute('data-carrier-id');
                    const carrierName = this.closest('tr').querySelector('td:nth-child(2) strong').textContent;
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–æ—Å–∏—Ç–µ–ª—å "${carrierName}"?`)) {
                        deleteCarrier(carrierId, this);
                    }
                });
            });

            document.querySelectorAll('.delete-issue-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const issueId = this.getAttribute('data-issue-id');
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≤—ã–¥–∞—á—É?')) {
                        deleteIssue(issueId, this);
                    }
                });
            });

            document.querySelectorAll('.delete-reader-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const readerId = this.getAttribute('data-reader-id');
                    const readerName = this.closest('tr').querySelector('td:nth-child(2) strong').textContent;
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${readerName}"?`)) {
                        deleteReader(readerId, this);
                    }
                });
            });

            document.querySelectorAll('.delete-genre-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const genreId = this.getAttribute('data-genre-id');
                    const genreName = this.closest('tr').querySelector('td:nth-child(2) strong').textContent;
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∂–∞–Ω—Ä "${genreName}"?`)) {
                        deleteGenre(genreId, this);
                    }
                });
            });

            document.querySelectorAll('.delete-director-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const directorId = this.getAttribute('data-director-id');
                    const directorName = this.closest('tr').querySelector('td:nth-child(2) strong').textContent;
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ "${directorName}"?`)) {
                        deleteDirector(directorId, this);
                    }
                });
            });
        }

        function deleteFilm(filmId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/films/${filmId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-film-id="${filmId}"]`).remove();
                        alert('–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        function deleteCarrier(carrierId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/carriers/${carrierId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-carrier-id="${carrierId}"]`).remove();
                        alert('–ù–æ—Å–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        function deleteIssue(issueId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/issues/${issueId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-issue-id="${issueId}"]`).remove();
                        alert('–í—ã–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞');
                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã –Ω–æ—Å–∏—Ç–µ–ª–µ–π
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        function deleteReader(readerId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/readers/${readerId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-reader-id="${readerId}"]`).remove();
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        function deleteGenre(genreId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/genres/${genreId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-genre-id="${genreId}"]`).remove();
                        alert('–ñ–∞–Ω—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        function deleteDirector(directorId, button) {
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            
            apiCall(`/api/admin/directors/${directorId}`, 'DELETE')
                .then(data => {
                    if (data.success) {
                        document.querySelector(`tr[data-director-id="${directorId}"]`).remove();
                        alert('–†–µ–∂–∏—Å—Å—ë—Ä —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.message);
                        button.disabled = false;
                        button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
                    button.disabled = false;
                    button.textContent = '–£–¥–∞–ª–∏—Ç—å';
                });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadFormData();
        setupDeleteHandlers();
    });
    </script>
</body>
</html>
