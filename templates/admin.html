<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–§–∏–ª—å–º–æ—Ç–µ–∫–∞ ‚Äî –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/styles.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">üé¨ –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ñ–∏–ª—å–º–æ—Ç–µ–∫–∏</h1>
        
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        {% if message %}
        <div class="alert alert-{{ message_type }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <!-- –§–æ—Ä–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ñ–∏–ª—å–º–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</h6>
                        <form class="row g-2" id="addFilmForm">
                            <div class="col-12">
                                <input type="text" name="name" class="form-control form-control-sm" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞" required>
                            </div>
                            <div class="col-12">
                                <input type="number" name="year" class="form-control form-control-sm" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞" required>
                            </div>
                            <div class="col-12">
                                <select name="director_id" class="form-control form-control-sm" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</option>
                                    {% for director in directors %}
                                    <option value="{{ director[0] }}">{{ director[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary btn-sm w-100" id="addFilmBtn">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</button>
                            </div>
                        </form>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –Ω–æ—Å–∏—Ç–µ–ª–µ–π -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Å–∏—Ç–µ–ª—å</h6>
                        <form class="row g-2" id="addCarrierForm">
                            <div class="col-12">
                                <select name="film_id" class="form-control form-control-sm" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º</option>
                                    {% for film in films %}
                                    <option value="{{ film[0] }}">{{ film[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-12">
                                <select name="type" class="form-control form-control-sm" required>
                                    <option value="">–¢–∏–ø –Ω–æ—Å–∏—Ç–µ–ª—è</option>
                                    <option value="DVD">DVD</option>
                                    <option value="Blu-ray">Blu-ray</option>
                                    <option value="–¶–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–ø–∏—è">–¶–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–ø–∏—è</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <select name="condition" class="form-control form-control-sm" required>
                                    <option value="">–°–æ—Å—Ç–æ—è–Ω–∏–µ</option>
                                    <option value="–û—Ç–ª–∏—á–Ω–æ–µ">–û—Ç–ª–∏—á–Ω–æ–µ</option>
                                    <option value="–•–æ—Ä–æ—à–µ–µ">–•–æ—Ä–æ—à–µ–µ</option>
                                    <option value="–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</option>
                                    <option value="–ü–ª–æ—Ö–æ–µ">–ü–ª–æ—Ö–æ–µ</option>
                                    <option value="–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–æ">–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–æ</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <input type="number" step="0.01" name="price" class="form-control form-control-sm" placeholder="–¶–µ–Ω–∞" required>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary btn-sm w-100" id="addCarrierBtn">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Å–∏—Ç–µ–ª—å</button>
                            </div>
                        </form>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h6>
                        <form class="row g-2" id="addReaderForm">
                            <div class="col-12">
                                <input type="text" name="fio" class="form-control form-control-sm" placeholder="–§–ò–û" required>
                            </div>
                            <div class="col-12">
                                <input type="text" name="phone" class="form-control form-control-sm" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary btn-sm w-100" id="addReaderBtn">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                            </div>
                        </form>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –∂–∞–Ω—Ä–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä</h6>
                        <form class="row g-2" id="addGenreForm">
                            <div class="col-12">
                                <input type="text" name="name" class="form-control form-control-sm" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∂–∞–Ω—Ä–∞" required>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary btn-sm w-100" id="addGenreBtn">–î–æ–±–∞–≤–∏—Ç—å –∂–∞–Ω—Ä</button>
                            </div>
                        </form>
                    </div>

                    <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–∂–∏—Å—Å—ë—Ä–æ–≤ -->
                    <div class="col-md-6 mb-3">
                        <h6>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</h6>
                        <form class="row g-2" id="addDirectorForm">
                            <div class="col-12">
                                <input type="text" name="name" class="form-control form-control-sm" placeholder="–§–ò–û —Ä–µ–∂–∏—Å—Å—ë—Ä–∞" required>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary btn-sm w-100" id="addDirectorBtn">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏—Å—Å—ë—Ä–∞</button>
                            </div>
                        </form>
                    </div>

                    <!-- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ -->
                    <div class="col-12 mt-3">
                        <div class="alert alert-warning py-2">
                            <h6 class="d-inline">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤: </h6>
                            <button type="button" class="btn btn-warning btn-sm" id="syncStatusesBtn">
                                –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion" id="adminAccordion">
            <!-- –§–∏–ª—å–º—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilms">
                        –§–∏–ª—å–º—ã ({{ films|length }})
                    </button>
                </h2>
                <div id="collapseFilms" class="accordion-collapse collapse show">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ì–æ–¥</th>
                                    <th>–†–µ–∂–∏—Å—Å—ë—Ä</th>
                                    <th>–ñ–∞–Ω—Ä—ã</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="filmsTable">
                                {% for film in films %}
                                <tr data-film-id="{{ film[0] }}">
                                    <td><strong>{{ film[1] }}</strong></td>
                                    <td>{{ film[2] }}</td>
                                    <td>{{ film[3] }}</td>
                                    <td>{{ film[4] | join(', ') if film[4] else '‚Äî' }}</td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="film" 
                                                data-entity-id="{{ film[0] }}"
                                                data-entity-name="{{ film[1] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ù–æ—Å–∏—Ç–µ–ª–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCarriers">
                        –ù–æ—Å–∏—Ç–µ–ª–∏ ({{ carriers|length }})
                    </button>
                </h2>
                <div id="collapseCarriers" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–¢–∏–ø</th>
                                    <th>–§–∏–ª—å–º</th>
                                    <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–†–µ–∂–∏—Å—Å—ë—Ä</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="carriersTable">
                                {% for carrier in carriers %}
                                <tr data-carrier-id="{{ carrier[0] }}">
                                    <td><span class="badge bg-info">{{ carrier[1] }}</span></td>
                                    <td><strong>{{ carrier[5] }}</strong></td>
                                    <td>
                                        {% if carrier[2] == '–û—Ç–ª–∏—á–Ω–æ–µ' %}
                                            <span class="badge bg-success">–û—Ç–ª–∏—á–Ω–æ–µ</span>
                                        {% elif carrier[2] == '–•–æ—Ä–æ—à–µ–µ' %}
                                            <span class="badge bg-primary">–•–æ—Ä–æ—à–µ–µ</span>
                                        {% elif carrier[2] == '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ' %}
                                            <span class="badge bg-warning">–£–¥–æ–≤–ª.</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ carrier[2] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if carrier[3] > 0 %}
                                            {{ "%.2f"|format(carrier[3]) }} ‚ÇΩ
                                        {% else %}
                                            <span class="text-muted">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if carrier[4] == '–î–æ—Å—Ç—É–ø–µ–Ω' %}
                                            <span class="badge bg-success">–î–æ—Å—Ç—É–ø–µ–Ω</span>
                                        {% elif carrier[4] == '–í—ã–¥–∞–Ω' %}
                                            <span class="badge bg-warning">–í—ã–¥–∞–Ω</span>
                                        {% elif carrier[4] == '–ù–∞ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü–∏–∏' %}
                                            <span class="badge bg-info">–ù–∞ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü–∏–∏</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ carrier[4] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ carrier[6] }}</td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="carrier" 
                                                data-entity-id="{{ carrier[0] }}"
                                                data-entity-name="{{ carrier[5] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –í—ã–¥–∞—á–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIssues">
                        –í—ã–¥–∞—á–∏ ({{ issues|length }})
                    </button>
                </h2>
                <div id="collapseIssues" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>–ù–æ—Å–∏—Ç–µ–ª—å</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                                    <th>–ü–ª–∞–Ω. –≤–æ–∑–≤—Ä–∞—Ç</th>
                                    <th>–§–∞–∫—Ç. –≤–æ–∑–≤—Ä–∞—Ç</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="issuesTable">
                                {% for issue in issues %}
                                <tr data-issue-id="{{ issue[0] }}">
                                    <td><strong>{{ issue[9] }}</strong> ({{ issue[8] }})</td>
                                    <td>{{ issue[7] }}</td>
                                    <td>{{ issue[3] }}</td>
                                    <td>{{ issue[4] }}</td>
                                    <td>{{ issue[5] or "‚Äî" }}</td>
                                    <td>
                                        {% if issue[6] == '–ê–∫—Ç–∏–≤–Ω–∞' %}
                                            <span class="badge bg-warning">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                        {% elif issue[6] == '–ó–∞–≤–µ—Ä—à–µ–Ω–∞' %}
                                            <span class="badge bg-success">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                                        {% else %}
                                            <span class="badge bg-danger">{{ issue[6] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="issue" 
                                                data-entity-id="{{ issue[0] }}"
                                                data-entity-name="–≤—ã–¥–∞—á—É {{ issue[9] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReaders">
                        –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ({{ readers|length }})
                    </button>
                </h2>
                <div id="collapseReaders" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–§–ò–û</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="readersTable">
                                {% for reader in readers %}
                                <tr data-reader-id="{{ reader[0] }}">
                                    <td>{{ reader[0] }}</td>
                                    <td><strong>{{ reader[1] }}</strong></td>
                                    <td>{{ reader[2] or "‚Äî" }}</td>
                                    <td>{{ reader[3] }}</td>
                                    <td>
                                        {% if reader[4] == '–ê–∫—Ç–∏–≤–µ–Ω' %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% elif reader[4] == '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' %}
                                            <span class="badge bg-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ reader[4] }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="reader" 
                                                data-entity-id="{{ reader[0] }}"
                                                data-entity-name="{{ reader[1] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ñ–∞–Ω—Ä—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGenres">
                        –ñ–∞–Ω—Ä—ã ({{ genres|length }})
                    </button>
                </h2>
                <div id="collapseGenres" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="genresTable">
                                {% for genre in genres %}
                                <tr data-genre-id="{{ genre[0] }}">
                                    <td>{{ genre[0] }}</td>
                                    <td><strong>{{ genre[1] }}</strong></td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="genre" 
                                                data-entity-id="{{ genre[0] }}"
                                                data-entity-name="{{ genre[1] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –†–µ–∂–∏—Å—Å—ë—Ä—ã -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDirectors">
                        –†–µ–∂–∏—Å—Å—ë—Ä—ã ({{ directors|length }})
                    </button>
                </h2>
                <div id="collapseDirectors" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–§–ò–û</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="directorsTable">
                                {% for director in directors %}
                                <tr data-director-id="{{ director[0] }}">
                                    <td>{{ director[0] }}</td>
                                    <td><strong>{{ director[1] }}</strong></td>
                                    <td>
                                        <button type="button" class="btn btn-danger btn-sm delete-btn" 
                                                data-entity-type="director" 
                                                data-entity-id="{{ director[0] }}"
                                                data-entity-name="{{ director[1] }}">
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Å—ã–ª–∫–∞ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div class="text-center mt-4">
            <a href="/cgi-bin/user.py" class="btn btn-outline-primary">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    class FilmotekaAdmin {
        constructor() {
            this.initEventListeners();
            this.setupAutoHideAlerts();
        }

        initEventListeners() {
            // Event listeners –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            document.getElementById('addFilmBtn').addEventListener('click', () => this.handleAddEntity('film'));
            document.getElementById('addCarrierBtn').addEventListener('click', () => this.handleAddEntity('carrier'));
            document.getElementById('addReaderBtn').addEventListener('click', () => this.handleAddEntity('reader'));
            document.getElementById('addGenreBtn').addEventListener('click', () => this.handleAddEntity('genre'));
            document.getElementById('addDirectorBtn').addEventListener('click', () => this.handleAddEntity('director'));
            
            // Event listener –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
            document.getElementById('syncStatusesBtn').addEventListener('click', () => this.handleSyncStatuses());

            // Event listener –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    this.handleDeleteEntity(e.target);
                }
            });

            // Event listeners –¥–ª—è –∞–∫–∫–æ—Ä–¥–∏–æ–Ω–∞
            this.setupAccordionListeners();
        }

        setupAccordionListeners() {
            const accordionButtons = document.querySelectorAll('.accordion-button');
            accordionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    this.handleAccordionToggle(button);
                });
            });
        }

        handleAccordionToggle(button) {
            const target = button.getAttribute('data-bs-target');
            const collapseElement = document.querySelector(target);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏
            if (collapseElement.classList.contains('show')) {
                collapseElement.style.transition = 'all 0.3s ease';
            }
        }

        async handleAddEntity(entityType) {
            const form = document.getElementById(`add${this.capitalizeFirst(entityType)}Form`);
            const button = document.getElementById(`add${this.capitalizeFirst(entityType)}Btn`);
            
            if (!this.validateForm(form)) {
                this.showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'danger');
                return;
            }

            const originalText = button.innerHTML;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            button.disabled = true;

            try {
                const formData = new FormData(form);
                formData.append('entity_type', entityType);

                const response = await fetch('/cgi-bin/admin_add.py', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.text();
                    this.showMessage('–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    form.reset();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                    setTimeout(() => location.reload(), 1000);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏');
                }

            } catch (error) {
                console.error('Error:', error);
                this.showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏', 'danger');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async handleDeleteEntity(button) {
            const entityType = button.getAttribute('data-entity-type');
            const entityId = button.getAttribute('data-entity-id');
            const entityName = button.getAttribute('data-entity-name');

            let message = `–£–¥–∞–ª–∏—Ç—å ${this.getEntityName(entityType)} "${entityName}"?`;
            if (entityType === 'issue') {
                message = '–£–¥–∞–ª–∏—Ç—å –≤—ã–¥–∞—á—É? –ù–æ—Å–∏—Ç–µ–ª—å —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º.';
            }

            if (!confirm(message)) {
                return;
            }

            const originalText = button.innerHTML;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            button.disabled = true;

            try {
                const formData = new FormData();
                formData.append('entity_type', entityType);
                formData.append('entity_id', entityId);

                const response = await fetch('/cgi-bin/admin_delete.py', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.text();
                    this.showMessage('–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                    this.animateRowRemoval(button.closest('tr'));
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                }

            } catch (error) {
                console.error('Error:', error);
                this.showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏', 'danger');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        animateRowRemoval(row) {
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
            row.style.transition = 'all 0.3s ease';
            row.style.opacity = '0';
            row.style.transform = 'translateX(-100px)';
            
            setTimeout(() => {
                row.remove();
                this.updateAccordionCounts();
            }, 300);
        }

        updateAccordionCounts() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∞–∫–∫–æ—Ä–¥–∏–æ–Ω–∞
            const entities = ['films', 'carriers', 'issues', 'readers', 'genres', 'directors'];
            entities.forEach(entity => {
                const table = document.getElementById(`${entity}Table`);
                if (table) {
                    const count = table.querySelectorAll('tr').length;
                    const accordionButton = document.querySelector(`[data-bs-target="#collapse${this.capitalizeFirst(entity)}"]`);
                    if (accordionButton) {
                        const originalText = accordionButton.textContent.replace(/\(\d+\)/, '');
                        accordionButton.textContent = `${originalText} (${count})`;
                    }
                }
            });
        }

        async handleSyncStatuses() {
            if (!confirm('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –Ω–æ—Å–∏—Ç–µ–ª–µ–π?')) {
                return;
            }

            const button = document.getElementById('syncStatusesBtn');
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
            button.disabled = true;

            try {
                const response = await fetch('/cgi-bin/admin_sync.py', {
                    method: 'POST'
                });

                if (response.ok) {
                    const result = await response.text();
                    this.showMessage('–°—Ç–∞—Ç—É—Å—ã —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                    setTimeout(() => location.reload(), 1000);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
                }

            } catch (error) {
                console.error('Error:', error);
                this.showMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', 'danger');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        validateForm(form) {
            const inputs = form.querySelectorAll('[required]');
            for (let input of inputs) {
                if (!input.value.trim()) {
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
                    input.classList.add('is-invalid');
                    input.addEventListener('input', () => {
                        if (input.value.trim()) {
                            input.classList.remove('is-invalid');
                        }
                    });
                    return false;
                }
            }
            return true;
        }

        getEntityName(entityType) {
            const names = {
                'film': '—Ñ–∏–ª—å–º',
                'carrier': '–Ω–æ—Å–∏—Ç–µ–ª—å', 
                'reader': '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
                'genre': '–∂–∞–Ω—Ä',
                'director': '—Ä–µ–∂–∏—Å—Å—ë—Ä–∞',
                'issue': '–≤—ã–¥–∞—á—É'
            };
            return names[entityType] || '–∑–∞–ø–∏—Å—å';
        }

        capitalizeFirst(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        showMessage(message, type = 'info') {
            let alertDiv = document.querySelector('.alert');
            if (!alertDiv) {
                alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.card'));
            } else {
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
            }

            // –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (alertDiv && alertDiv.parentNode) {
                    const bsAlert = new bootstrap.Alert(alertDiv);
                    bsAlert.close();
                }
            }, 5000);
        }

        setupAutoHideAlerts() {
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                });
            }, 5000);
        }
    }

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
    class AdminUtils {
        static formatDate(dateString) {
            if (!dateString) return '‚Äî';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        static formatPrice(price) {
            if (!price || price == 0) return '<span class="text-muted">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>';
            return `${parseFloat(price).toFixed(2)} ‚ÇΩ`;
        }

        static animateElement(element, animationClass) {
            element.classList.add(animationClass);
            setTimeout(() => {
                element.classList.remove(animationClass);
            }, 1000);
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
        const admin = new FilmotekaAdmin();
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        const style = document.createElement('style');
        style.textContent = `
            .fade-in {
                animation: fadeIn 0.5s ease-in;
            }
            .slide-out {
                animation: slideOut 0.3s ease-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes slideOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(-100px); }
            }
            .is-invalid {
                border-color: #dc3545 !important;
                box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
            }
        `;
        document.head.appendChild(style);
    });
    </script>
</body>
</html>
